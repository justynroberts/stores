- description: Effectue la cl√¥ture de caisse pour tous les magasins et synchronise
    avec le syst√®me central
  executionEnabled: true
  group: Retail
  id: 130e04af-fb17-406f-b9b1-1c3306dac185
  loglevel: INFO
  name: Cl√¥ture de Caisse Centralis√©e
  nodeFilterEditable: true
  notification:
    onfailure:
      email:
        recipients: 'operations@carrefour.fr,support@carrefour.fr'
        subject: ‚ùå √âchec de la cl√¥ture de caisse
    onsuccess:
      email:
        recipients: operations@carrefour.fr
        subject: ‚úÖ Cl√¥ture de caisse r√©ussie
  notifyAvgDurationThreshold: null
  plugins:
    ExecutionLifecycle: null
  schedule:
    dayofmonth:
      day: '*'
    month: '*'
    time:
      hour: '23'
      minute: '30'
      seconds: '0'
    year: '*'
  scheduleEnabled: false
  schedules: []
  sequence:
    commands:
    - interpreterArgsQuoted: false
      script: |-
        #!/bin/bash

        echo "========================================"
        echo "CL√îTURE DE CAISSE CENTRALIS√âE"
        echo "========================================"
        echo "D√©but de la cl√¥ture √† $(date)"
        echo ""

        # V√©rification des syst√®mes
        echo "[$(date +%H:%M:%S)] V√©rification de l'√©tat des caisses..."
        sleep 2
        echo "[$(date +%H:%M:%S)] üü¢ Magasin 0: 5 caisses actives"
        sleep 1
        echo "[$(date +%H:%M:%S)] üü¢ Magasin 1: 4 caisses actives"
        echo ""

        # D√©but de la cl√¥ture
        echo "[$(date +%H:%M:%S)] D√©marrage de la s√©quence de cl√¥ture..."
        echo ""

        # Magasin 0
        echo "üìç MAGASIN 0"
        echo "-------------"
        for i in {1..5}; do
            echo "[$(date +%H:%M:%S)] Cl√¥ture caisse $i..."
            sleep 1
            MONTANT=$((800 + RANDOM % 500))
            echo "[$(date +%H:%M:%S)] ‚úì Caisse $i cl√¥tur√©e - Montant: ‚Ç¨$MONTANT"
        done
        echo ""

        # Magasin 1
        echo "üìç MAGASIN 1"
        echo "-------------"
        for i in {1..4}; do
            echo "[$(date +%H:%M:%S)] Cl√¥ture caisse $i..."
            sleep 1
            MONTANT=$((700 + RANDOM % 400))
            echo "[$(date +%H:%M:%S)] ‚úì Caisse $i cl√¥tur√©e - Montant: ‚Ç¨$MONTANT"
        done
        echo ""

        # Synchronisation
        echo "[$(date +%H:%M:%S)] Synchronisation avec le syst√®me central..."
        sleep 3
        echo "[$(date +%H:%M:%S)] ‚úì Donn√©es synchronis√©es avec SAP"
        echo ""

        # Sauvegarde
        echo "[$(date +%H:%M:%S)] Sauvegarde des donn√©es de cl√¥ture..."
        sleep 2
        echo "[$(date +%H:%M:%S)] ‚úì Sauvegarde compl√®te: backup_$(date +%Y%m%d_%H%M%S).tar.gz"
        echo ""

        # Rapport final
        echo "üìã R√âSUM√â DE CL√îTURE"
        echo "==================="
        echo "Total caisses cl√¥tur√©es: 9"
        echo "Statut: ‚úÖ Succ√®s"
        echo "Heure de fin: $(date +%H:%M:%S)"
        echo ""
        echo "‚úÖ Cl√¥ture de caisse centralis√©e termin√©e avec succ√®s!"
      scriptInterpreter: bash
    keepgoing: false
    strategy: node-first
  uuid: 130e04af-fb17-406f-b9b1-1c3306dac185

